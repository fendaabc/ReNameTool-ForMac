# 需求文档

## 介绍

本规范定义了一个增强的文件重命名工具界面，提供直观的文件管理、实时预览和批量重命名功能。该界面包含文件列表显示、重命名规则配置、实时预览和批量操作功能，为用户提供完整的文件重命名解决方案。

### 来源与对齐声明

- 主来源：`docs/prototype-v3-interface.md`（UI/交互/功能的最终依据）
- 辅来源：`docs/04.CHANGELOG.md` 与 `docs/archive/ROADMAP-v3.0.md`（用于补充阶段目标、性能指标与技术约束）
- 冲突处理：若与辅来源不一致，一律以原型文档为准
- 追踪约定：本文件“需求编号”在 `design.md` 与 `tasks.md` 中一一映射，便于追踪
- 非本版本范围（v3.0）：多步撤销/重做（需要后端历史栈）、高级规则（时间戳/字符清理/字段重组/拼音等）、自动冲突重命名策略（作为设置项进入 v3.x）、规则预设的持久化（可选）

## 需求

### 需求1：文件列表显示和管理

**用户故事：** 作为用户，我希望能够查看和管理要重命名的文件列表，这样我就能清楚地了解哪些文件将被处理。

#### 验收标准

1. 当我打开应用时，系统应显示一个包含文件名、新文件名、扩展名、大小和修改时间列的表格
2. 当我添加文件时，系统应在表格中显示每个文件的详细信息
3. 当我选择文件时，系统应支持单选和多选操作
4. 当我右键点击文件时，系统应显示上下文菜单选项
5. 当文件列表为空时，系统应显示提示信息引导用户添加文件

### 需求2：文件添加和导入功能

**用户故事：** 作为用户，我希望能够通过多种方式添加文件到重命名列表，这样我就能灵活地选择要处理的文件。

#### 验收标准

1. 当我点击"添加文件/文件夹"按钮时，系统应打开文件选择对话框
3. 当我拖拽文件到应用窗口时，系统应自动添加这些文件到列表
4. 当我添加重复文件时，系统应提示用户并提供处理选项
5. 当文件添加成功时，系统应更新文件计数显示

### 需求3：重命名规则配置

**用户故事：** 作为用户，我希望能够配置各种重命名规则，这样我就能根据需要自定义文件名格式。

#### 验收标准

1. 当我在右侧面板中时，系统应提供重命名模式选择（查找替换、添加序列、切片替换、大小写转换、拓展名修改）

2. 当我选择序列号模式时，系统应允许我设置起始数字和位数，以及添加这些序列号是作为文件名前缀还是后缀（重命名一般都和扩展名无关）

3. 当我配置各类规则参数（如查找/替换、序列起始/步长/宽度、切片起止/替换、大小写模式、拓展名设置）时，每个规则都应该有具体的设置页面，需要的每个参数都有对应的输入框或者勾选框可以输入或者选择，系统也应实时应用到预览中

4. 当我修改任何重命名规则时，系统应立即更新当前页面所能展示的所有文件的预览名称，如果用户滚动了文件列表那相应的应该也能看到滚动到的位置的文件的预览名称

   

### 需求4：实时预览功能

**用户故事：** 作为用户，我希望在执行重命名之前能够预览结果，这样我就能确认重命名效果是否符合预期。

#### 验收标准

1. 当我修改重命名规则时，系统应在"新文件名"列中实时显示预览结果
2. 当预览名称与现有文件冲突时，系统应用不同颜色或图标标识
3. 当预览名称包含非法字符时，系统应高亮显示并提供警告
4. 当我选择不同的文件时，系统应显示该文件的具体预览信息
5. 当预览更新时，系统应保持界面响应性，不出现卡顿

### 需求5：批量重命名执行

**用户故事：** 作为用户，我希望能够批量执行重命名操作，这样我就能高效地处理大量文件。

#### 验收标准

1. 当我点击"开始重命名"按钮时，系统应对所有选中的文件执行重命名
2. 当重命名进行时，系统应显示进度条和当前处理的文件信息
3. 当重命名完成时，系统应显示成功和失败的文件统计
4. 当重命名过程中出现错误时，系统应记录错误信息并继续处理其他文件
5. 当重命名完成后，系统应更新文件列表显示新的文件名

### 需求6：撤销和恢复功能（后续版本功能，当前版本不做处理）

**用户故事：** 作为用户，我希望能够撤销重命名操作，这样我就能在出现错误时恢复原始文件名。

#### 验收标准

1. 当重命名操作完成后，系统应启用"撤销"按钮
2. 当我点击撤销时，系统应将所有文件恢复到原始名称
3. 当撤销操作进行时，系统应显示撤销进度
4. 当撤销完成时，系统应更新文件列表并禁用撤销按钮
5. 当我添加新文件或修改规则时，系统应清除撤销历史

### 需求7：用户界面和交互体验

**用户故事：** 作为用户，我希望有一个直观美观的界面，这样我就能轻松地使用所有功能。

#### 验收标准

1. 当我使用应用时，界面应采用现代化的设计风格，包含清晰的图标和按钮
2. 当我调整窗口大小时，界面元素应自适应调整布局
3. 当我使用键盘快捷键时，系统应支持常用操作（如Ctrl+A全选、Delete删除等），直接选中或者删除已经在文件列表中的这些文件
4. 当我悬停在按钮或控件上时，系统应显示工具提示说明
5. 当操作完成时，系统应提供适当的视觉反馈和状态提示

### 需求8：文件过滤和搜索

**用户故事：** 作为用户，我希望能够过滤和搜索文件列表，这样我就能快速找到特定的文件。

#### 验收标准

1. 当我在搜索框中输入关键词时，系统应实时过滤显示匹配的文件（只能按文件名或者是扩展名进行搜索，支持模糊匹配）
2. 当我选择文件类型过滤器时，系统应只显示指定类型的文件
3. 当我按文件大小或修改时间排序时，系统应相应地重新排列文件列表
4. 当我清除搜索条件时，系统应恢复显示所有文件
5. 当过滤结果为空时，系统默认不进行过滤

### 需求9：顶部工具栏与全局设置

**用户故事：** 作为用户，我希望通过顶部工具栏快速完成关键操作和全局配置，这样我就能高效地控制应用状态。

#### 验收标准

1. 当应用启动时，顶部工具栏应显示应用标题与图标、"开始重命名"按钮、"清空列表"按钮、主题切换控件和全局设置入口
2. 当文件列表为空或存在冲突/非法名称时，"开始重命名"按钮应禁用并展示原因提示
3. 当我点击"清空列表"时，应清空文件列表、规则配置、预览状态并重置统计
4. 当我切换主题时，界面主题立即生效并持久化到本地存储
5. 当我打开全局设置时，应提供与重命名相关的通用选项（如冲突处理策略、非法字符替换策略）

### 需求10：主题与外观一致性

**用户故事：** 作为用户，我希望不同主题与控件外观保持一致，这样在不同环境下视觉体验统一。

#### 验收标准

1. 当我在亮色/暗色主题之间切换时，所有面板底色与分割线保持一致且可读性良好
2. 当我与表单控件交互（含radio、checkbox、switch）时，有明确的选中/聚焦反馈；在Pico.css下自定义样式稳定可见
3. 当界面在窄屏下显示时，布局保持可用性，Tab与按钮不溢出
4. 当控件获得键盘焦点时，焦点样式清晰可见，满足可访问性要求

### 需求11：底部状态栏与进度/统计

**用户故事：** 作为用户，我希望始终看到当前文件数量与操作进度，这样我能把控整体状态。

#### 验收标准

1. 当文件加载/移除时，状态栏应实时显示总数、选中数、已成功/失败数
2. 当我选中文件时，状态栏应显示该文件的详细信息（名称、大小、修改时间等）
3. 当执行重命名或撤销时，应显示百分比进度与当前处理的文件
4. 当操作完成时，应显示成功/失败统计与简要总结

### 需求12：跨平台与性能指标

**用户故事：** 作为用户，我希望在Windows与macOS上都能稳定高效地运行，这样不受平台限制。

#### 验收标准

1. 当在Windows 10/11与macOS 12+上运行时，核心功能一致可用，特殊字符与路径处理正确
2. 当处理1万文件的预览时，界面保持可交互，单次预览刷新目标<100ms（以批量局部刷新与防抖策略达成）
3. 当应用空闲时，内存占用<50MB；常规工作状态<200MB（参考基线）
4. 当进行批量重命名时，不发生UI卡死，进度反馈流畅

### 需求13：规则覆盖范围（v3.0）

**用户故事：** 作为用户，我希望v3.0就能覆盖常见重命名规则，这样大多数需求无需等待后续版本。

#### 验收标准

1. 当我配置规则时，至少支持：查找替换、添加序列（编号）、切片替换、大小写转换、扩展名修改
2. 当我切换不同规则Tab时，预览应立即更新并高亮变更
3. 当我保存/加载规则预设时（可选），参数能正确还原
4. 高级规则（时间戳、字符清理、字段重组、拼音/音译等）可在v3.x后续版本实现，不作为v3.0必交付

#### 验收标准

1. 当重命名完成后，应至少支持一次性“撤销本次批量操作”的能力
2. 当前版本如仅有前端快照撤销，应清晰提示其限制（应用重启或状态变更可能丢失历史）
3. 多步撤销/重做与后端历史堆栈纳入v3.x规划，需在设计文档与任务中明确技术方案与边界