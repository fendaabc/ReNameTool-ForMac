<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–‡ä»¶æ‰¹é‡é‡å‘½å - æ‹–æ‹½æµ‹è¯•</title>
    <link rel="icon" href="data:," />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />
    <style>
      body {
        padding: 1rem;
      }
      #drop-zone {
        border: 2px dashed var(--pico-primary);
        padding: 2rem;
        text-align: center;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      #drop-zone:hover {
        background-color: rgba(var(--pico-primary-rgb), 0.1);
      }

      #drop-zone button:hover {
        background-color: rgba(var(--pico-primary-rgb), 0.15);
        border-color: var(--pico-primary);
      }
      .preview-highlight {
        color: var(--pico-primary);
        font-weight: bold;
      }
      .dimmed {
        color: var(--pico-secondary);
      }
      main {
  display: grid;
  grid-template-columns: minmax(340px, 2.2fr) minmax(280px, 1fr);
  gap: 1.2rem;
  align-items: start;
  height: 65vh;
  min-height: 380px;
  max-width: 1200px;
  margin: 0 auto;
}

aside {
  max-width: 420px;
  width: 100%;
}

@media (max-width: 1200px) {
  main {
    grid-template-columns: 1.6fr 1fr;
    gap: 0.8rem;
  }
  aside {
    max-width: 100%;
  }
}

@media (max-width: 800px) {
  main {
    display: flex;
    flex-direction: column;
    height: auto;
  }
  aside {
    order: 1;
    max-width: 100%;
    width: 100%;
  }
  section {
    order: 2;
    max-width: 100%;
    width: 100%;
  }
  
  /* å·¥å…·æ å“åº”å¼ */
  .toolbar {
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .toolbar .right-group {
    flex-wrap: wrap;
    gap: 0.3rem;
  }
  
  .toolbar .right-group button {
    font-size: 0.9em;
    padding: 0.4rem 0.8rem;
  }
}

@media (max-width: 600px) {
  /* Tabç»„å“åº”å¼ */
  .tab-group {
    overflow-x: auto;
    scrollbar-width: thin;
    -webkit-overflow-scrolling: touch;
  }
  
  .tab-group::-webkit-scrollbar {
    height: 4px;
  }
  
  .tab-group::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
    border-radius: 2px;
  }
  
  .tab-group::-webkit-scrollbar-thumb {
    background: var(--pico-primary);
    border-radius: 2px;
  }
  
  .tab-link {
    white-space: nowrap;
    min-width: auto;
    font-size: 0.8em;
    padding: 0.35em 0.8em;
  }
  
  /* å·¥å…·æ è¿›ä¸€æ­¥ä¼˜åŒ– */
  .toolbar h3 {
    font-size: 1.1em;
  }
  
  .toolbar .right-group {
    width: 100%;
    justify-content: space-between;
  }
  
  /* æ”¹è¿›æŒ‰é’®ç»„å¸ƒå±€ */
  .toolbar .right-group button {
    min-width: 44px; /* ç¡®ä¿è§¦æ‘¸å‹å¥½çš„æœ€å°å°ºå¯¸ */
    padding: 0.4rem 0.6rem;
  }
  
  /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ä¿æŒåœ†å½¢ */
  #theme-toggle {
    min-width: 40px !important;
    width: 40px !important;
    height: 40px !important;
    flex-shrink: 0 !important;
  }
}
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      /* Toolbar & Status Bar */
      .toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        padding: 0.5rem 0.25rem 0.6rem 0.25rem;
      }
      .toolbar .left-group { display: flex; align-items: center; gap: 0.5rem; }
      .toolbar .right-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .status-bar {
        position: sticky;
        bottom: 0;
        z-index: 3;
        padding: 0.5rem 0.75rem;
        border-top: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--pico-background-color, #fff);
      }
      .status-bar .status-left span { margin-right: 1rem; }
      .status-bar .status-right { color: var(--pico-secondary); }
    </style>
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body>
    <a href="#main-content" class="skip-link">è·³è½¬åˆ°ä¸»è¦å†…å®¹</a>
    <header class="toolbar" style="padding: 0.5rem 1rem; background: var(--pico-background-color); border-bottom: 1px solid var(--pico-border-color); position: sticky; top: 0; z-index: 1000;">
      <div class="left-group" style="display: flex; align-items: center; gap: 1rem;">
        <img src="src-tauri/icons/32x32.png" alt="logo" style="width:32px;height:32px;">
        <h3 style="margin: 0; font-size: 1.2rem;">æ–‡ä»¶æ‰¹é‡é‡å‘½å</h3>
      </div>
      <div class="right-group" style="display: flex; align-items: center; gap: 0.5rem;">
        <button id="apply-rename" class="primary-action" title="å¼€å§‹é‡å‘½å" aria-label="å¼€å§‹é‡å‘½åé€‰ä¸­çš„æ–‡ä»¶" aria-describedby="file-count" aria-keyshortcuts="Ctrl+Enter" style="padding: 0.5rem 1rem;">å¼€å§‹é‡å‘½å</button>
        <button id="clear-all" class="secondary-action" title="æ¸…ç©ºåˆ—è¡¨" aria-label="æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶å’Œè§„åˆ™è®¾ç½®" aria-keyshortcuts="Ctrl+Shift+C" style="padding: 0.5rem 1rem;">æ¸…ç©º</button>
        <button id="show-shortcuts" class="secondary-action" title="é”®ç›˜å¿«æ·é”®" aria-label="æ˜¾ç¤ºé”®ç›˜å¿«æ·é”®å¸®åŠ©" style="padding: 0.5rem 1rem;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 3a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h12z"></path>
            <path d="M9 9h6v6H9z"></path>
            <path d="M9 3v6h6V3"></path>
          </svg>
        </button>
        <button id="theme-toggle" style="background: none; border: none; cursor: pointer; opacity: 0.9;">
          <span id="theme-icon" aria-label="åˆ‡æ¢ä¸»é¢˜" style="display:inline-block;width:28px;height:28px;vertical-align:middle;">
            <svg id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:block;"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
          </span>
        </button>
      </div>
    </header>


    <main id="main-content">
      <section style="display: flex; flex-direction: column; height:100%;">
        <div id="drop-zone" class="card-group" style="border:2px dashed var(--pico-primary);border-radius:13px;padding:1.5rem 1rem;margin-bottom:1.2rem;background:#fafdff;display:flex;flex-direction:column;align-items:center;gap:0.85rem;transition:background 0.18s;">
  <div style="display:flex;gap:0.7rem;">
    <button id="select-files-btn" class="outline" aria-label="é€‰æ‹©è¦é‡å‘½åçš„æ–‡ä»¶">é€‰æ‹©æ–‡ä»¶</button>
    <button id="select-folder-btn" class="outline" aria-label="é€‰æ‹©åŒ…å«è¦é‡å‘½åæ–‡ä»¶çš„æ–‡ä»¶å¤¹">é€‰æ‹©æ–‡ä»¶å¤¹</button>
  </div>
  <span style="font-size:0.98em;color:var(--pico-primary);font-weight:500;">å¯æ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹æˆ–ç‚¹å‡»æŒ‰é’®å¯¼å…¥</span>
</div>

<!-- æœç´¢å’Œè¿‡æ»¤åŒºåŸŸ -->
<div id="search-filter-section" style="margin-bottom:1rem;display:none;">
  <div style="display:grid;grid-template-columns:1fr auto auto;gap:0.8rem;align-items:end;">
    <div>
      <label for="search-input" style="font-size:0.9em;margin-bottom:0.3rem;display:block;">æœç´¢æ–‡ä»¶</label>
      <input type="text" id="search-input" placeholder="æŒ‰æ–‡ä»¶åæˆ–æ‰©å±•åæœç´¢..." aria-describedby="search-help" style="margin-bottom:0;">
      <small id="search-help" class="form-text" style="margin-top:0.2rem;">æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œå®æ—¶è¿‡æ»¤</small>
    </div>
    <div>
      <label for="extension-filter" style="font-size:0.9em;margin-bottom:0.3rem;display:block;">æ–‡ä»¶ç±»å‹</label>
      <select id="extension-filter" aria-describedby="filter-help" style="margin-bottom:0;">
        <option value="">æ‰€æœ‰ç±»å‹</option>
      </select>
      <small id="filter-help" class="form-text" style="margin-top:0.2rem;">æŒ‰æ‰©å±•åè¿‡æ»¤</small>
    </div>
    <div>
      <button id="clear-search" class="outline secondary" style="margin-bottom:0;" title="æ¸…é™¤æœç´¢æ¡ä»¶" aria-label="æ¸…é™¤æ‰€æœ‰æœç´¢å’Œè¿‡æ»¤æ¡ä»¶">æ¸…é™¤</button>
    </div>
  </div>
</div>

<hr style="margin:0.6rem 0 1.1rem 0;border:0;border-top:1.5px dashed #e0e8ef;">

        <div style="flex: 1; display: flex; flex-direction: column;">
          <div class="file-list-scroll" style="flex:1 1 auto;max-height:60vh;min-height:180px;overflow:auto;border-radius:8px;box-shadow:0 1px 6px #0001;">
  <table style="width:100%; font-size: 0.9em;">
    <thead>
      <tr>
        <th colspan="7" id="file-count" style="text-align:left; font-size:0.92em; font-weight:normal; color:var(--pico-secondary); background:transparent;">å·²åŠ è½½ 0 ä¸ªæ–‡ä»¶</th>
      </tr>
      <tr>
        <th scope="col" style="width:28px;">
          <input id="select-all" type="checkbox" title="å…¨é€‰/å–æ¶ˆå…¨é€‰" aria-label="å…¨é€‰æˆ–å–æ¶ˆå…¨é€‰æ‰€æœ‰æ–‡ä»¶" />
        </th>
        <th scope="col">#</th>
        <th scope="col" id="th-name" data-sort="name" class="sortable" title="ç‚¹å‡»æŒ‰åç§°æ’åº" tabindex="0" role="button" aria-label="æŒ‰æ–‡ä»¶åæ’åº">åŸæ–‡ä»¶å</th>
        <th scope="col" id="th-ext" data-sort="extension" class="sortable" title="ç‚¹å‡»æŒ‰æ‰©å±•åæ’åº" tabindex="0" role="button" aria-label="æŒ‰æ‰©å±•åæ’åº">æ‰©å±•å</th>
        <th scope="col" id="th-size" data-sort="size" class="sortable" title="ç‚¹å‡»æŒ‰å¤§å°æ’åº" tabindex="0" role="button" aria-label="æŒ‰æ–‡ä»¶å¤§å°æ’åº">å¤§å°</th>
        <th scope="col" id="th-time" data-sort="modified_ms" class="sortable" title="ç‚¹å‡»æŒ‰ä¿®æ”¹æ—¶é—´æ’åº" tabindex="0" role="button" aria-label="æŒ‰ä¿®æ”¹æ—¶é—´æ’åº">ä¿®æ”¹æ—¶é—´</th>
        <th scope="col">æ–°æ–‡ä»¶å (é¢„è§ˆ)</th>
      </tr>
    </thead>
    <tbody id="file-table-body" role="grid" aria-label="æ–‡ä»¶åˆ—è¡¨">
  <tr id="empty-tip-row">
    <td colspan="7" style="text-align:center;color:var(--pico-secondary);padding:2.5em 0;font-size:1.05em;" role="gridcell">æš‚æ— æ–‡ä»¶ï¼Œè¯·æ‹–æ‹½æˆ–é€‰æ‹©æ–‡ä»¶/æ–‡ä»¶å¤¹å¯¼å…¥</td>
  </tr>
</tbody>
  </table>
</div>
        </div>
        
      </section>

      <aside style="display: flex; flex-direction: column; height:100%; justify-content: space-between;">
        <div>
          <hgroup>
            <h4>é‡å‘½åè§„åˆ™</h4>
            <h5 style="margin-bottom:0.5rem;">ä¸€æ¬¡åªå¯é€‰æ‹©å¹¶æ‰§è¡Œä¸€ç§è§„åˆ™</h5>
          </hgroup>

          <nav style="margin-bottom: 1rem;" role="tablist" aria-label="é‡å‘½åè§„åˆ™é€‰æ‹©">
  <div class="tab-group" style="display:flex;gap:0.3rem;flex-wrap:wrap;">
    <button type="button" id="tab-replace-btn" class="tab-link active" data-tab="tab-replace" role="tab" aria-selected="true" aria-controls="tab-replace" style="font-size:0.85em;padding:0.4rem 0.6rem;">æŸ¥æ‰¾æ›¿æ¢</button>
    <button type="button" id="tab-sequence-btn" class="tab-link" data-tab="tab-sequence" role="tab" aria-selected="false" aria-controls="tab-sequence" style="font-size:0.85em;padding:0.4rem 0.6rem;">æ·»åŠ åºåˆ—</button>
    <button type="button" id="tab-slice-btn" class="tab-link" data-tab="tab-slice" role="tab" aria-selected="false" aria-controls="tab-slice" style="font-size:0.85em;padding:0.4rem 0.6rem;">åˆ‡ç‰‡æ›¿æ¢</button>
    <button type="button" id="tab-case-btn" class="tab-link" data-tab="tab-case" role="tab" aria-selected="false" aria-controls="tab-case" style="font-size:0.85em;padding:0.4rem 0.6rem;">å¤§å°å†™</button>
    <button type="button" id="tab-extension-btn" class="tab-link" data-tab="tab-extension" role="tab" aria-selected="false" aria-controls="tab-extension" style="font-size:0.85em;padding:0.4rem 0.6rem;">æ‰©å±•å</button>
  </div>
</nav>

          <div id="tab-replace" class="tab-content active" role="tabpanel" aria-labelledby="tab-replace-btn">
            <label for="find">æŸ¥æ‰¾å†…å®¹</label>
            <input type="text" id="find" name="find" placeholder="ä¾‹å¦‚: IMG_" aria-describedby="find-help" />
            <small id="find-help" class="form-text">è¾“å…¥è¦åœ¨æ–‡ä»¶åä¸­æŸ¥æ‰¾çš„æ–‡æœ¬</small>
            
            <label for="replace">æ›¿æ¢ä¸º</label>
            <input
              type="text"
              id="replace"
              name="replace"
              placeholder="ä¾‹å¦‚: æ—…è¡Œç…§ç‰‡-"
              aria-describedby="replace-help"
            />
            <small id="replace-help" class="form-text">è¾“å…¥ç”¨äºæ›¿æ¢çš„æ–°æ–‡æœ¬</small>
            
            <fieldset style="margin-top: 1rem;">
              <legend>é€‰é¡¹</legend>
              <label for="regex-mode">
                <input type="checkbox" id="regex-mode" name="regex" aria-describedby="regex-help" />
                ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
              </label>
              <small id="regex-help" class="form-text">å¯ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼è¿›è¡Œé«˜çº§åŒ¹é…</small>
              
              <label for="case-sensitive">
                <input type="checkbox" id="case-sensitive" name="caseSensitive" aria-describedby="case-help" />
                åŒºåˆ†å¤§å°å†™
              </label>
              <small id="case-help" class="form-text">åŒ¹é…æ—¶åŒºåˆ†å­—æ¯å¤§å°å†™</small>
            </fieldset>
          </div>

          <div id="tab-sequence" class="tab-content" role="tabpanel" aria-labelledby="tab-sequence-btn">
            <fieldset role="radiogroup" aria-labelledby="position-legend">
              <legend id="position-legend">åºåˆ—å·ä½ç½®</legend>
              <label for="pos-prefix">
                <input
                  type="radio"
                  id="pos-prefix"
                  name="position"
                  value="prefix"
                  checked
                  aria-describedby="prefix-help"
                />
                å‰ç¼€
              </label>
              <small id="prefix-help" class="form-text">åœ¨æ–‡ä»¶åå‰æ·»åŠ åºåˆ—å·</small>
              <label for="pos-suffix">
                <input
                  type="radio"
                  id="pos-suffix"
                  name="position"
                  value="suffix"
                  aria-describedby="suffix-help"
                />
                åç¼€
              </label>
              <small id="suffix-help" class="form-text">åœ¨æ–‡ä»¶ååï¼ˆæ‰©å±•åå‰ï¼‰æ·»åŠ åºåˆ—å·</small>
            </fieldset>
            <label for="start">èµ·å§‹æ•°å­—</label>
            <input type="number" id="start" name="start" value="1" min="0" max="999999" aria-describedby="start-help" />
            <small id="start-help" class="form-text">åºåˆ—å·çš„èµ·å§‹æ•°å­—</small>
            
            <label for="step">æ­¥é•¿</label>
            <input type="number" id="step" name="step" value="1" min="1" max="1000" aria-describedby="step-help" />
            <small id="step-help" class="form-text">æ¯ä¸ªæ–‡ä»¶åºåˆ—å·çš„å¢é‡</small>
            
            <label for="digits">æ•°å­—ä½æ•° (ä¸è¶³è¡¥0)</label>
            <input
              type="number"
              id="digits"
              name="digits"
              value="2"
              min="1"
              max="10"
              placeholder="ä¾‹å¦‚: 2 ä¼šç”Ÿæˆ 01, 02..."
              aria-describedby="digits-help"
            />
            <small id="digits-help" class="form-text">åºåˆ—å·çš„ä½æ•°ï¼Œä¸è¶³æ—¶å‰é¢è¡¥0</small>
            
            <label for="sequence-order">æ’åºä¾æ®</label>
            <select id="sequence-order" name="order" aria-describedby="order-help">
              <option value="current">å½“å‰æ’åº</option>
              <option value="name">æŒ‰æ–‡ä»¶å</option>
              <option value="size">æŒ‰æ–‡ä»¶å¤§å°</option>
              <option value="modified">æŒ‰ä¿®æ”¹æ—¶é—´</option>
            </select>
            <small id="order-help" class="form-text">åºåˆ—å·åˆ†é…çš„æ’åºä¾æ®</small>
          </div>

          <div id="tab-slice" class="tab-content" role="tabpanel" aria-labelledby="tab-slice-btn">
            <label for="slice-start">èµ·å§‹ä½ç½®</label>
            <input type="number" id="slice-start" name="sliceStart" value="0" min="-255" max="255" aria-describedby="slice-start-help" />
            <small id="slice-start-help" class="form-text">å­—ç¬¦ä¸²å¼€å§‹ä½ç½®ï¼Œ0è¡¨ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œè´Ÿæ•°è¡¨ç¤ºä»æœ«å°¾å€’æ•°</small>
            
            <label for="slice-end">ç»“æŸä½ç½®</label>
            <input type="number" id="slice-end" name="sliceEnd" value="" min="-255" max="255" placeholder="ç•™ç©ºè¡¨ç¤ºåˆ°æœ«å°¾" aria-describedby="slice-end-help" />
            <small id="slice-end-help" class="form-text">å­—ç¬¦ä¸²ç»“æŸä½ç½®ï¼Œç•™ç©ºè¡¨ç¤ºåˆ°æœ«å°¾ï¼Œè´Ÿæ•°è¡¨ç¤ºä»æœ«å°¾å€’æ•°</small>
            
            <label for="slice-replacement">æ›¿æ¢å†…å®¹</label>
            <input type="text" id="slice-replacement" name="sliceReplacement" placeholder="ä¾‹å¦‚: æ–°æ–‡æœ¬" aria-describedby="slice-replacement-help" />
            <small id="slice-replacement-help" class="form-text">ç”¨äºæ›¿æ¢é€‰å®šèŒƒå›´çš„æ–°æ–‡æœ¬ï¼Œç•™ç©ºè¡¨ç¤ºåˆ é™¤</small>
            
            <fieldset style="margin-top: 1rem;">
              <legend>é€‰é¡¹</legend>
              <label for="slice-preserve-extension">
                <input type="checkbox" id="slice-preserve-extension" name="preserveExtension" checked aria-describedby="preserve-ext-help" />
                ä¿ç•™æ‰©å±•å
              </label>
              <small id="preserve-ext-help" class="form-text">åªå¯¹æ–‡ä»¶åä¸»ä½“è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œä¿æŒæ‰©å±•åä¸å˜</small>
            </fieldset>
          </div>

          <div id="tab-case" class="tab-content" role="tabpanel" aria-labelledby="tab-case-btn">
            <fieldset role="radiogroup" aria-labelledby="case-legend">
              <legend id="case-legend">è½¬æ¢è§„åˆ™</legend>
              <label for="case-upper">
                <input type="radio" id="case-upper" name="caseType" value="upper" aria-describedby="upper-help" />
                å…¨éƒ¨å¤§å†™ï¼ˆUPPERCASEï¼‰
              </label>
              <small id="upper-help" class="form-text">å°†æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå¤§å†™</small>
              
              <label for="case-lower">
                <input type="radio" id="case-lower" name="caseType" value="lower" aria-describedby="lower-help" />
                å…¨éƒ¨å°å†™ï¼ˆlowercaseï¼‰
              </label>
              <small id="lower-help" class="form-text">å°†æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå°å†™</small>
              
              <label for="case-title">
                <input type="radio" id="case-title" name="caseType" value="title" aria-describedby="title-help" />
                æ ‡é¢˜æ ¼å¼ï¼ˆTitle Caseï¼‰
              </label>
              <small id="title-help" class="form-text">æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™</small>
              
              <label for="case-snake">
                <input type="radio" id="case-snake" name="caseType" value="snake" aria-describedby="snake-help" />
                è›‡å½¢å‘½åï¼ˆsnake_caseï¼‰
              </label>
              <small id="snake-help" class="form-text">å°†ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå…¨éƒ¨å°å†™</small>
              
              <label for="case-kebab">
                <input type="radio" id="case-kebab" name="caseType" value="kebab" aria-describedby="kebab-help" />
                çŸ­æ¨ªçº¿å‘½åï¼ˆkebab-caseï¼‰
              </label>
              <small id="kebab-help" class="form-text">å°†ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦æ›¿æ¢ä¸ºçŸ­æ¨ªçº¿ï¼Œå…¨éƒ¨å°å†™</small>
            </fieldset>
            
            <fieldset style="margin-top: 1rem;">
              <legend>é€‰é¡¹</legend>
              <label for="case-preserve-extension">
                <input type="checkbox" id="case-preserve-extension" name="preserveExtension" checked aria-describedby="case-preserve-ext-help" />
                ä¿ç•™æ‰©å±•å
              </label>
              <small id="case-preserve-ext-help" class="form-text">åªå¯¹æ–‡ä»¶åä¸»ä½“è¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œä¿æŒæ‰©å±•åä¸å˜</small>
            </fieldset>
          </div>

          <div id="tab-extension" class="tab-content" role="tabpanel" aria-labelledby="tab-extension-btn">
            <fieldset role="radiogroup" aria-labelledby="ext-mode-legend">
              <legend id="ext-mode-legend">æ“ä½œæ¨¡å¼</legend>
              <label for="ext-mode-change">
                <input type="radio" id="ext-mode-change" name="extensionMode" value="change" checked aria-describedby="change-help" />
                ä¿®æ”¹æ‰©å±•å
              </label>
              <small id="change-help" class="form-text">å°†æ–‡ä»¶æ‰©å±•åæ›´æ”¹ä¸ºæŒ‡å®šçš„æ–°æ‰©å±•å</small>
              
              <label for="ext-mode-remove">
                <input type="radio" id="ext-mode-remove" name="extensionMode" value="remove" aria-describedby="remove-help" />
                ç§»é™¤æ‰©å±•å
              </label>
              <small id="remove-help" class="form-text">å®Œå…¨ç§»é™¤æ–‡ä»¶çš„æ‰©å±•å</small>
              
              <label for="ext-mode-add">
                <input type="radio" id="ext-mode-add" name="extensionMode" value="add" aria-describedby="add-help" />
                æ·»åŠ æ‰©å±•å
              </label>
              <small id="add-help" class="form-text">ä¸ºæ²¡æœ‰æ‰©å±•åçš„æ–‡ä»¶æ·»åŠ æ‰©å±•å</small>
            </fieldset>
            
            <div id="new-extension-group">
              <label for="new-extension">æ–°æ‰©å±•å</label>
              <input type="text" id="new-extension" name="newExtension" placeholder="ä¾‹å¦‚: txt, jpg, pdf" aria-describedby="new-ext-help" />
              <small id="new-ext-help" class="form-text">è¾“å…¥æ–°çš„æ‰©å±•åï¼ˆä¸éœ€è¦åŒ…å«ç‚¹å·ï¼‰</small>
            </div>
            
            <fieldset style="margin-top: 1rem;">
              <legend>é€‰é¡¹</legend>
              <label for="ext-force-change">
                <input type="checkbox" id="ext-force-change" name="forceChange" aria-describedby="force-help" />
                å¼ºåˆ¶ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶
              </label>
              <small id="force-help" class="form-text">å³ä½¿æ–‡ä»¶å·²æœ‰æ‰©å±•åä¹Ÿå¼ºåˆ¶ä¿®æ”¹ï¼ˆä»…åœ¨"æ·»åŠ æ‰©å±•å"æ¨¡å¼ä¸‹æœ‰æ•ˆï¼‰</small>
              
              <label for="ext-case-preserve">
                <input type="checkbox" id="ext-case-preserve" name="preserveCase" checked aria-describedby="case-preserve-help" />
                ä¿æŒæ‰©å±•åå¤§å°å†™
              </label>
              <small id="case-preserve-help" class="form-text">ä¿æŒè¾“å…¥çš„æ‰©å±•åå¤§å°å†™ï¼Œå¦åˆ™è½¬æ¢ä¸ºå°å†™</small>
            </fieldset>
          </div>
        </div>

      </aside>

    </main>

    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <footer class="status-bar">
      <div class="status-left">
        <span id="status-total">æ€»è®¡: 0 ä¸ªæ–‡ä»¶</span>
        <span id="status-selected">å·²é€‰: 0 ä¸ª</span>
        <span id="status-changed">å°†å˜æ›´: 0 ä¸ª</span>
        <span id="status-conflicts" style="color: var(--pico-del-color); display: none;">å†²çª: 0 ä¸ª</span>
        <span id="status-invalid" style="color: var(--pico-del-color); display: none;">éæ³•: 0 ä¸ª</span>
      </div>
      <div class="status-right">
        <div id="status-progress-container" style="display: none; align-items: center; gap: 0.5rem;">
          <progress id="status-progress-bar" value="0" max="100" style="width: 120px; height: 8px;"></progress>
          <span id="status-progress-text">0%</span>
        </div>
        <span id="status-progress" style="display: none;">å¤„ç†ä¸­...</span>
        <span id="status-info">å°±ç»ª</span>
      </div>
    </footer>
    
    <!-- å¼•å…¥ä¸»é¢˜ç®¡ç†å™¨ -->
    <script src="src/theme-manager.js"></script>
    <!-- å¼•å…¥æœç´¢è¿‡æ»¤ç®¡ç†å™¨ -->
    <script src="src/search-filter-manager.js"></script>
    <!-- å¼•å…¥é¢„è§ˆç®¡ç†å™¨ -->
    <script src="src/preview-manager.js"></script>
    <!-- å¼•å…¥çŠ¶æ€æ ç®¡ç†å™¨ -->
    <script src="src/status-bar-manager.js"></script>
    <!-- å¼•å…¥æ“ä½œæ§åˆ¶å™¨ -->
    <script src="src/action-controls.js"></script>
    
    <script>
      console.log("ğŸš€ å¼€å§‹è®¾ç½®åº”ç”¨");

        document.addEventListener("DOMContentLoaded", async function () {
          // --- å¤§å°å†™æŒ‰é’®ç»„é«˜äº®ä¸åˆ‡æ¢ ---
          document.querySelectorAll('.case-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              document.querySelectorAll('.case-btn').forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
            });
          });
          // --- åºåˆ—å·å‰ç¼€/åç¼€å•é€‰æŒ‰é’®ä¿®å¤ ---
          document.querySelectorAll('input[name="position"]').forEach(function(radio){
            radio.addEventListener('change',function(){
              document.querySelectorAll('input[name="position"]').forEach(r=>{
                if(r!==radio) r.checked=false;
              });
              radio.checked=true;
            });
          });
          // --- Tabåˆ‡æ¢ï¼šä¸ºæ‰€æœ‰.tab-linkæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ ---
          document.querySelectorAll('.tab-link').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
              e.preventDefault();
              switchToTab(btn);
            });
            
            // æ·»åŠ é”®ç›˜å¯¼èˆªæ”¯æŒ
            btn.addEventListener('keydown', function(e) {
              if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                e.preventDefault();
                const tabs = Array.from(document.querySelectorAll('.tab-link'));
                const currentIndex = tabs.indexOf(btn);
                let newIndex;
                
                if (e.key === 'ArrowLeft') {
                  newIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;
                } else {
                  newIndex = currentIndex < tabs.length - 1 ? currentIndex + 1 : 0;
                }
                
                const newTab = tabs[newIndex];
                newTab.focus();
                switchToTab(newTab);
              }
            });
          });
          
          function switchToTab(btn) {
            // ç§»é™¤æ‰€æœ‰tab-linkå’Œtab-contentçš„active
            document.querySelectorAll('.tab-link').forEach(b => {
              b.classList.remove('active');
              b.setAttribute('aria-selected', 'false');
            });
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // å½“å‰tab-linkå’Œå¯¹åº”å†…å®¹åŠ active
            btn.classList.add('active');
            btn.setAttribute('aria-selected', 'true');
            var tabId = btn.getAttribute('data-tab');
            var tabContent = document.getElementById(tabId);
            if(tabContent) tabContent.classList.add('active');
            
            // ç«‹å³æ›´æ–°é¢„è§ˆ
            if (window.updatePreview) {
              window.updatePreview();
            }
            console.log("Tab switched to:", tabId);
          }
          console.log("ğŸ“‹ DOM å·²åŠ è½½");
          // æ£€æŸ¥ Tauri API
          if (typeof window.__TAURI__ === "undefined") {
            console.error("âŒ Tauri API ä¸å¯ç”¨");
            return;
          }
          console.log("âœ… Tauri API å¯ç”¨");

        // è®¾ç½®æŒ‰é’®äº‹ä»¶
        setupButtons();

          // å°è¯•è®¾ç½®æ‹–æ‹½ï¼ˆå¯èƒ½ä¸å·¥ä½œï¼‰
          await setupDragDrop();

          // é¡¶éƒ¨å·¥å…·æ æŒ‰é’®è”åŠ¨ç°åœ¨ç”±ActionControlså¤„ç†
          const settingsBtn = document.getElementById("open-settings");
          if (settingsBtn) {
            settingsBtn.addEventListener("click", () => alert("è®¾ç½®é¢æ¿å¼€å‘ä¸­"));
          }
          
          const shortcutsBtn = document.getElementById("show-shortcuts");
          if (shortcutsBtn) {
            shortcutsBtn.addEventListener("click", showKeyboardShortcuts);
          }
          
          // å®šä¹‰é”®ç›˜å¿«æ·é”®å¸®åŠ©å‡½æ•°
          function showKeyboardShortcuts() {
            const shortcuts = [
              { key: 'Ctrl+A / Cmd+A', desc: 'å…¨é€‰æ–‡ä»¶' },
              { key: 'Ctrl+D / Cmd+D', desc: 'å–æ¶ˆå…¨é€‰' },
              { key: 'Delete / Backspace', desc: 'åˆ é™¤é€‰ä¸­æ–‡ä»¶' },
              { key: 'Ctrl+Enter / Cmd+Enter', desc: 'å¼€å§‹é‡å‘½å' },
              { key: 'Ctrl+Shift+C / Cmd+Shift+C', desc: 'æ¸…ç©ºåˆ—è¡¨' },
              { key: 'F5', desc: 'åˆ·æ–°é¢„è§ˆ' },
              { key: 'F2', desc: 'å¼€å§‹é‡å‘½åï¼ˆå¦‚æœ‰é€‰ä¸­æ–‡ä»¶ï¼‰' },
              { key: 'Escape', desc: 'å–æ¶ˆæ“ä½œæˆ–å…³é—­å¯¹è¯æ¡†' },
              { key: 'â†‘/â†“', desc: 'å¯¼èˆªæ–‡ä»¶åˆ—è¡¨' },
              { key: 'Space', desc: 'åˆ‡æ¢æ–‡ä»¶é€‰æ‹©çŠ¶æ€' },
              { key: 'Home/End', desc: 'è·³è½¬åˆ°ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªæ–‡ä»¶' },
              { key: 'Shift+ç‚¹å‡»', desc: 'èŒƒå›´é€‰æ‹©æ–‡ä»¶' }
            ];
            
            const shortcutList = shortcuts.map(s => 
              `<tr><td style="font-family: monospace; font-weight: bold; padding: 0.5rem;">${s.key}</td><td style="padding: 0.5rem;">${s.desc}</td></tr>`
            ).join('');
            
            const dialog = `
              <div id="shortcuts-dialog" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                <div style="background: var(--pico-background-color, #fff); border-radius: 12px; padding: 2rem; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                  <h3 style="margin-top: 0; color: var(--pico-primary);">é”®ç›˜å¿«æ·é”®</h3>
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="border-bottom: 2px solid #ddd;">
                        <th style="text-align: left; padding: 0.5rem;">å¿«æ·é”®</th>
                        <th style="text-align: left; padding: 0.5rem;">åŠŸèƒ½</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${shortcutList}
                    </tbody>
                  </table>
                  <div style="text-align: right; margin-top: 2rem;">
                    <button onclick="document.getElementById('shortcuts-dialog').remove()" style="padding: 0.75rem 1.5rem;">å…³é—­</button>
                  </div>
                </div>
              </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', dialog);
            
            // ç‚¹å‡»é®ç½©å…³é—­
            const dialogEl = document.getElementById('shortcuts-dialog');
            dialogEl.addEventListener('click', (e) => {
              if (e.target === dialogEl) {
                dialogEl.remove();
              }
            });
            
            // ESCé”®å…³é—­
            const handleEsc = (e) => {
              if (e.key === 'Escape') {
                dialogEl.remove();
                document.removeEventListener('keydown', handleEsc);
              }
            };
            document.addEventListener('keydown', handleEsc);
          }
        });

      function setupButtons() {
        const selectFilesBtn = document.getElementById("select-files-btn");
        const applyRenameBtn = document.getElementById("apply-rename");
        const clearAllBtn = document.getElementById("clear-all");

        selectFilesBtn.addEventListener("click", async () => {
          try {
            const { open } = window.__TAURI__.dialog;
            const selected = await open({
              multiple: true,
              directory: false,
            });

            if (selected) {
              const files = Array.isArray(selected) ? selected : [selected];
              console.log("é€‰ä¸­çš„æ–‡ä»¶:", files);
              displayFiles(files);
            }
          } catch (error) {
            console.error("æ–‡ä»¶é€‰æ‹©å¤±è´¥:", error);
            alert("æ–‡ä»¶é€‰æ‹©å¤±è´¥: " + error.message);
          }
        });

        // æŒ‰é’®äº‹ä»¶ç°åœ¨ç”±ActionControlså¤„ç†
        console.log("ğŸ“‹ [HTML] setupButtons å®Œæˆï¼ŒæŒ‰é’®äº‹ä»¶ç”±ActionControlså¤„ç†");

        // å®æ—¶é¢„è§ˆ - ä¸ºæ‰€æœ‰è¾“å…¥æ§ä»¶æ·»åŠ 
        const findInput = document.getElementById("find");
        const replaceInput = document.getElementById("replace");
        const startInput = document.getElementById("start");
        const digitsInput = document.getElementById("digits");

        // ç›´æ¥ç»‘å®šé¢„è§ˆäº‹ä»¶ï¼Œä½¿ç”¨ç®€å•çš„æ–¹å¼
        function bindPreviewEvents() {
          console.log("ğŸ“‹ [HTML] å¼€å§‹ç»‘å®šé¢„è§ˆäº‹ä»¶");
          
          findInput.addEventListener("input", () => {
            console.log("ğŸ“‹ [HTML] findè¾“å…¥å˜åŒ–");
            if (window.updatePreview) window.updatePreview();
          });
          
          replaceInput.addEventListener("input", () => {
            console.log("ğŸ“‹ [HTML] replaceè¾“å…¥å˜åŒ–");
            if (window.updatePreview) window.updatePreview();
          });
          
          startInput.addEventListener("input", () => {
            console.log("ğŸ“‹ [HTML] startè¾“å…¥å˜åŒ–");
            if (window.updatePreview) window.updatePreview();
          });
          
          digitsInput.addEventListener("input", () => {
            console.log("ğŸ“‹ [HTML] digitsè¾“å…¥å˜åŒ–");
            if (window.updatePreview) window.updatePreview();
          });

          // ä¸ºåºåˆ—ä½ç½®å•é€‰æ¡†æ·»åŠ é¢„è§ˆæ›´æ–°
          document.querySelectorAll('input[name="position"]').forEach(function(radio) {
            radio.addEventListener('change', () => {
              console.log("ğŸ“‹ [HTML] positionå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          });

          // ä¸ºåˆ‡ç‰‡æ›¿æ¢è¾“å…¥æ¡†æ·»åŠ é¢„è§ˆæ›´æ–°
          const sliceStartInput = document.getElementById("slice-start");
          const sliceEndInput = document.getElementById("slice-end");
          const sliceReplacementInput = document.getElementById("slice-replacement");
          const preserveExtensionCheckbox = document.getElementById("slice-preserve-extension");
          
          if (sliceStartInput) {
            sliceStartInput.addEventListener("input", () => {
              console.log("ğŸ“‹ [HTML] slice-startå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }
          
          if (sliceEndInput) {
            sliceEndInput.addEventListener("input", () => {
              console.log("ğŸ“‹ [HTML] slice-endå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }
          
          if (sliceReplacementInput) {
            sliceReplacementInput.addEventListener("input", () => {
              console.log("ğŸ“‹ [HTML] slice-replacementå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }
          
          if (preserveExtensionCheckbox) {
            preserveExtensionCheckbox.addEventListener("change", () => {
              console.log("ğŸ“‹ [HTML] preserve-extensionå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }

          // ä¸ºå¤§å°å†™è½¬æ¢å•é€‰æ¡†æ·»åŠ é¢„è§ˆæ›´æ–°
          document.querySelectorAll('#tab-case input[name="caseType"]').forEach(function(radio) {
            radio.addEventListener('change', () => {
              console.log("ğŸ“‹ [HTML] caseTypeå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          });

          // ä¸ºæ‰©å±•åä¿®æ”¹è¾“å…¥æ¡†æ·»åŠ é¢„è§ˆæ›´æ–°
          const extensionModeRadios = document.querySelectorAll('input[name="extensionMode"]');
          const newExtensionInput = document.getElementById("new-extension");
          const forceChangeCheckbox = document.getElementById("ext-force-change");
          const preserveCaseCheckbox = document.getElementById("ext-case-preserve");
          
          extensionModeRadios.forEach(function(radio) {
            radio.addEventListener('change', () => {
              console.log("ğŸ“‹ [HTML] extensionModeå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          });
          
          if (newExtensionInput) {
            newExtensionInput.addEventListener("input", () => {
              console.log("ğŸ“‹ [HTML] new-extensionå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }
          
          if (forceChangeCheckbox) {
            forceChangeCheckbox.addEventListener("change", () => {
              console.log("ğŸ“‹ [HTML] force-changeå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }
          
          if (preserveCaseCheckbox) {
            preserveCaseCheckbox.addEventListener("change", () => {
              console.log("ğŸ“‹ [HTML] preserve-caseå˜åŒ–");
              if (window.updatePreview) window.updatePreview();
            });
          }
          
          console.log("ğŸ“‹ [HTML] é¢„è§ˆäº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆ");
        }
        
        // ç«‹å³ç»‘å®šäº‹ä»¶
        bindPreviewEvents();
      }

      async function setupDragDrop() {
        try {
          const { listen } = window.__TAURI__.event;

          // å°è¯•å¤šç§å¯èƒ½çš„äº‹ä»¶åç§°
          const eventNames = [
            "tauri://file-drop",
            "tauri://drag-drop",
            "file-drop",
            "drag-drop",
          ];

          for (const eventName of eventNames) {
            try {
              await listen(eventName, (event) => {
                console.log(`ğŸ‰ æ£€æµ‹åˆ°äº‹ä»¶ ${eventName}:`, event);
                console.log(`ğŸ‰ äº‹ä»¶è½½è·:`, event.payload);

                // æ£€æŸ¥è½½è·çš„ç»“æ„
                if (event.payload) {
                  if (Array.isArray(event.payload)) {
                    // å¦‚æœè½½è·ç›´æ¥æ˜¯æ•°ç»„
                    displayFiles(event.payload);
                  } else if (
                    event.payload.paths &&
                    Array.isArray(event.payload.paths)
                  ) {
                    // å¦‚æœè½½è·æœ‰ paths å±æ€§
                    displayFiles(event.payload.paths);
                  } else if (typeof event.payload === "object") {
                    // å¦‚æœè½½è·æ˜¯å¯¹è±¡ï¼Œå°è¯•æ‰¾åˆ°æ–‡ä»¶è·¯å¾„
                    console.log("ğŸ” è½½è·å¯¹è±¡ç»“æ„:", Object.keys(event.payload));

                    // å°è¯•å¸¸è§çš„å±æ€§å
                    const possibleKeys = [
                      "files",
                      "items",
                      "data",
                      "filePaths",
                    ];
                    let found = false;

                    for (const key of possibleKeys) {
                      if (
                        event.payload[key] &&
                        Array.isArray(event.payload[key])
                      ) {
                        displayFiles(event.payload[key]);
                        found = true;
                        break;
                      }
                    }

                    if (!found) {
                      console.log(
                        "æ£€æµ‹åˆ°æ‹–æ‹½ï¼Œä½†æ— æ³•è§£ææ–‡ä»¶è·¯å¾„ã€‚è½½è·ç»“æ„: " +
                          Object.keys(event.payload).join(", ")
                      );
                    }
                  } else {
                    console.log("ğŸ¤” æœªçŸ¥çš„è½½è·æ ¼å¼:", typeof event.payload);
                  }
                } else {
                  console.log("æ£€æµ‹åˆ°æ‹–æ‹½äº‹ä»¶ï¼Œä½†æ²¡æœ‰è½½è·æ•°æ®");
                }
              });
              console.log(`âœ… ç›‘å¬äº‹ä»¶: ${eventName}`);
            } catch (e) {
              console.log(`âŒ æ— æ³•ç›‘å¬äº‹ä»¶: ${eventName}`);
            }
          }

          // ä¹Ÿå°è¯•æ‚¬åœå’Œå–æ¶ˆäº‹ä»¶
          try {
            await listen("tauri://file-drop-hover", (event) => {
              console.log("ğŸ¯ æ‹–æ‹½æ‚¬åœ");
              document.body.style.backgroundColor = "#f0f8ff";
            });

            await listen("tauri://file-drop-cancelled", (event) => {
              console.log("âŒ æ‹–æ‹½å–æ¶ˆ");
              document.body.style.backgroundColor = "";
            });
          } catch (e) {
            console.log("âŒ æ— æ³•è®¾ç½®æ‚¬åœ/å–æ¶ˆäº‹ä»¶");
          }
        } catch (error) {
          console.error("âŒ æ‹–æ‹½è®¾ç½®å¤±è´¥:", error);
        }
      }

      // displayFileså‡½æ•°å·²åœ¨ä¸‹æ–¹é‡æ–°å®šä¹‰

      // å…¨å±€å˜é‡å­˜å‚¨å½“å‰æ–‡ä»¶åˆ—è¡¨
      let currentFiles = [];

      // çŠ¶æ€æ æ›´æ–°å‡½æ•°
      function updateStatusBar({ total = 0, selected = 0, success = 0, failed = 0, message = "" } = {}) {
        const el = document.getElementById("status-bar");
        if (!el) return;
        const setText = (id, val) => {
          const node = document.getElementById(id);
          if (node) node.textContent = String(val);
        };
        setText("sb-total", total);
        setText("sb-selected", selected);
        setText("sb-success", success);
        setText("sb-failed", failed);
        const msg = document.getElementById("sb-message");
        if (msg) msg.textContent = message;
      }

      // å¤„ç†æ–‡ä»¶å¤¹
      async function handleFolders(folders) {
        console.log("å¤„ç†æ–‡ä»¶å¤¹:", folders);

        try {
          const { invoke } = window.__TAURI__.core;

          if (folders.length === 1) {
            // å•ä¸ªæ–‡ä»¶å¤¹ï¼šå±•å¼€å†…éƒ¨æ–‡ä»¶
            console.log("å•ä¸ªæ–‡ä»¶å¤¹æ¨¡å¼ï¼šå±•å¼€å†…éƒ¨æ–‡ä»¶");
            const files = await invoke("get_files_from_paths", {
              paths: folders,
            });
            console.log("å±•å¼€çš„æ–‡ä»¶:", files);
            displayFiles(files);
          } else {
            // å¤šä¸ªæ–‡ä»¶å¤¹ï¼šé‡å‘½åæ–‡ä»¶å¤¹æœ¬èº«
            console.log("å¤šä¸ªæ–‡ä»¶å¤¹æ¨¡å¼ï¼šé‡å‘½åæ–‡ä»¶å¤¹æœ¬èº«");
            displayFiles(folders);
          }
        } catch (error) {
          console.error("å¤„ç†æ–‡ä»¶å¤¹å¤±è´¥:", error);
          alert("å¤„ç†æ–‡ä»¶å¤¹å¤±è´¥: " + error.message);
        }
      }

      // æ™ºèƒ½å¤„ç†é€‰ä¸­çš„é¡¹ç›®
      async function handleSelectedItems(items) {
        console.log("å¤„ç†é€‰ä¸­çš„é¡¹ç›®:", items);

        try {
          const { invoke } = window.__TAURI__.core;

          // æ£€æŸ¥é€‰ä¸­é¡¹ç›®çš„ç±»å‹
          const itemTypes = await Promise.all(
            items.map(async (item) => {
              try {
                // è°ƒç”¨åç«¯æ£€æŸ¥æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹
                const result = await invoke("get_files_from_paths", {
                  paths: [item],
                });
                return {
                  path: item,
                  isDirectory:
                    result.length > 1 ||
                    (result.length === 1 && result[0] !== item),
                  files: result,
                };
              } catch (error) {
                console.error("æ£€æŸ¥é¡¹ç›®ç±»å‹å¤±è´¥:", item, error);
                return {
                  path: item,
                  isDirectory: false,
                  files: [item],
                };
              }
            })
          );

          console.log("é¡¹ç›®ç±»å‹åˆ†æ:", itemTypes);

          // åˆ¤æ–­å¤„ç†é€»è¾‘
          const directories = itemTypes.filter((item) => item.isDirectory);
          const files = itemTypes.filter((item) => !item.isDirectory);

          let finalFiles = [];

          if (directories.length === 1 && files.length === 0) {
            // å•ä¸ªæ–‡ä»¶å¤¹ï¼šé‡å‘½åæ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶
            console.log("å•ä¸ªæ–‡ä»¶å¤¹æ¨¡å¼ï¼šé‡å‘½åæ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶");
            finalFiles = directories[0].files;
          } else if (directories.length > 1 && files.length === 0) {
            // å¤šä¸ªæ–‡ä»¶å¤¹ï¼šé‡å‘½åæ–‡ä»¶å¤¹æœ¬èº«
            console.log("å¤šä¸ªæ–‡ä»¶å¤¹æ¨¡å¼ï¼šé‡å‘½åæ–‡ä»¶å¤¹æœ¬èº«");
            finalFiles = directories.map((dir) => dir.path);
          } else if (files.length > 0 && directories.length === 0) {
            // åªæœ‰æ–‡ä»¶ï¼šé‡å‘½åæ–‡ä»¶
            console.log("æ–‡ä»¶æ¨¡å¼ï¼šé‡å‘½åæ–‡ä»¶");
            finalFiles = files.map((file) => file.path);
          } else {
            // æ··åˆæ¨¡å¼ï¼šæ–‡ä»¶å¤¹å±•å¼€ä¸ºå†…éƒ¨æ–‡ä»¶ï¼Œæ–‡ä»¶ä¿æŒåŸæ ·
            console.log("æ··åˆæ¨¡å¼ï¼šæ–‡ä»¶å¤¹å±•å¼€ï¼Œæ–‡ä»¶ä¿æŒ");
            finalFiles = [];

            // æ·»åŠ æ‰€æœ‰æ–‡ä»¶
            files.forEach((file) => {
              finalFiles.push(file.path);
            });

            // æ·»åŠ æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶
            directories.forEach((dir) => {
              finalFiles.push(...dir.files);
            });
          }

          console.log("æœ€ç»ˆæ–‡ä»¶åˆ—è¡¨:", finalFiles);
          displayFiles(finalFiles);
        } catch (error) {
          console.error("å¤„ç†é€‰ä¸­é¡¹ç›®å¤±è´¥:", error);
          alert("å¤„ç†é€‰ä¸­é¡¹ç›®å¤±è´¥: " + error.message);
        }
      }

      // æ›´æ–° displayFiles å‡½æ•°ä»¥ä¿å­˜æ–‡ä»¶åˆ—è¡¨
      function displayFiles(files) {
        currentFiles = files; // ä¿å­˜åˆ°å…¨å±€å˜é‡
        
        // åŒæ­¥åˆ°main.jsä¸­çš„loadedFileså˜é‡
        if (window.setLoadedFiles) {
          window.setLoadedFiles(files);
        }

        const tbody = document.getElementById("file-table-body");
        tbody.innerHTML = "";

        files.forEach((file, index) => {
          const fileName = file.split("/").pop() || file.split("\\\\").pop();
          // åˆå§‹çŠ¶æ€ä¸æ˜¾ç¤ºé¢„è§ˆï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥è§„åˆ™åå†æ›´æ–°
          const previewName = fileName;
          const hasChange = false;

          const row = document.createElement("tr");
          row.innerHTML = `
            <th scope="row">${index + 1}</th>
            <td>${fileName}</td>
            <td class="preview-cell ${
              hasChange ? "preview-highlight" : "dimmed"
            }">
                ${hasChange ? previewName : "(æ— å˜åŒ–)"}
            </td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById(
          "file-count"
        ).textContent = `å·²åŠ è½½ ${files.length} ä¸ªæ–‡ä»¶`;
        console.log("ğŸ“ æ˜¾ç¤ºæ–‡ä»¶:", files);
        // æ›´æ–°çŠ¶æ€æ 
        updateStatusBar({ total: files.length, selected: 0 });
        
        // åˆå§‹åŒ–é¢„è§ˆ
        setTimeout(() => {
          if (window.updatePreview) {
            console.log("ğŸ“ [displayFiles] è°ƒç”¨updatePreviewåˆå§‹åŒ–é¢„è§ˆ");
            window.updatePreview();
          }
        }, 100);
      }

      // è·å–é¢„è§ˆåç§° - æ”¯æŒæ‰€æœ‰æ ‡ç­¾é¡µç±»å‹
      function getPreviewName(fileName, fileIndex = 0) {
        const activeTab = document.querySelector(".tab-content.active");
        if (!activeTab) return fileName;

        const tabId = activeTab.id;

        switch (tabId) {
          case "tab-replace": {
            const findText = document.getElementById("find").value;
            const replaceText = document.getElementById("replace").value;
            if (!findText) return fileName;
            return fileName.replace(new RegExp(findText, "g"), replaceText);
          }
          case "tab-sequence": {
            const start = parseInt(document.getElementById("start").value) || 1;
            const digits = parseInt(document.getElementById("digits").value) || 2;
            const position = document.querySelector('input[name="position"]:checked')?.value || "prefix";
            
            const currentSequenceNumber = start + fileIndex;
            const sequenceNumber = currentSequenceNumber.toString().padStart(digits, "0");
            
            const fileExtension = fileName.includes(".") ? "." + fileName.split(".").pop() : "";
            const fileNameWithoutExt = fileName.includes(".") ? fileName.substring(0, fileName.lastIndexOf(".")) : fileName;
            
            return position === "prefix" 
              ? `${sequenceNumber}_${fileName}`
              : `${fileNameWithoutExt}_${sequenceNumber}${fileExtension}`;
          }
          case "tab-case": {
            const checked = document.querySelector('#tab-case input[name="caseType"]:checked');
            if (!checked) return fileName;
            const val = checked.value;
            
            if (val === "lower") return fileName.toLowerCase();
            else if (val === "upper") return fileName.toUpperCase();
            else if (val === "capitalize") {
              return fileName.replace(/(^|[^a-zA-Z])([a-z])/g, (m, pre, char) => pre + char.toUpperCase());
            }
            return fileName;
          }
          default:
            return fileName;
        }
      }

      // æ‰§è¡Œé‡å‘½ååŠŸèƒ½ç”± main.js ä¸­çš„å®Œæ•´å®ç°å¤„ç†

      // æ¸…ç©ºæ‰€æœ‰
      function clearAll() {
        currentFiles = [];
        const tbody = document.getElementById("file-table-body");
        tbody.innerHTML = "";
        document.getElementById("file-count").textContent = "å·²åŠ è½½ 0 ä¸ªæ–‡ä»¶";

        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById("find").value = "";
        document.getElementById("replace").value = "";

        // æ›´æ–°çŠ¶æ€æ 
        updateStatusBar({ total: 0, selected: 0, success: 0, failed: 0, message: "" });
      }

      // updatePreviewå‡½æ•°ç°åœ¨ç”±main.jsæä¾›
      
      // æ˜¾ç¤ºé”®ç›˜å¿«æ·é”®å¸®åŠ©
      function showKeyboardShortcuts() {
        const shortcuts = [
          { key: 'Ctrl+A / Cmd+A', desc: 'å…¨é€‰æ‰€æœ‰æ–‡ä»¶' },
          { key: 'Ctrl+D / Cmd+D', desc: 'å–æ¶ˆå…¨é€‰' },
          { key: 'Delete / Backspace', desc: 'åˆ é™¤é€‰ä¸­æ–‡ä»¶' },
          { key: 'â†‘ / â†“', desc: 'ä¸Šä¸‹å¯¼èˆªé€‰æ‹©æ–‡ä»¶' },
          { key: 'Shift + â†‘ / â†“', desc: 'æ‰©å±•é€‰æ‹©èŒƒå›´' },
          { key: 'Space', desc: 'åˆ‡æ¢å½“å‰æ–‡ä»¶é€‰æ‹©çŠ¶æ€' },
          { key: 'Home', desc: 'è·³åˆ°ç¬¬ä¸€ä¸ªæ–‡ä»¶' },
          { key: 'End', desc: 'è·³åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶' },
          { key: 'F2', desc: 'å¼€å§‹é‡å‘½åé€‰ä¸­æ–‡ä»¶' },
          { key: 'Escape', desc: 'å–æ¶ˆé€‰æ‹©æˆ–å…³é—­èœå•' },
          { key: 'â† / â†’', desc: 'åœ¨è§„åˆ™æ ‡ç­¾é—´åˆ‡æ¢' },
          { key: 'Enter / Space', desc: 'æ¿€æ´»æŒ‰é’®æˆ–æ’åº' }
        ];
        
        let helpText = 'é”®ç›˜å¿«æ·é”®ï¼š\n\n';
        shortcuts.forEach(shortcut => {
          helpText += `${shortcut.key}: ${shortcut.desc}\n`;
        });
        
        alert(helpText);
      }
    </script>
  <script src="src/virtual-scroll.js"></script>
  <script type="module" src="src/main.js"></script>

  <!-- åº•éƒ¨çŠ¶æ€æ  -->
  <footer id="status-bar" class="status-bar">
    <div class="status-left">
      <span>æ€»æ•°: <strong id="sb-total">0</strong></span>
      <span>é€‰ä¸­: <strong id="sb-selected">0</strong></span>
      <span>æˆåŠŸ: <strong id="sb-success">0</strong></span>
      <span>å¤±è´¥: <strong id="sb-failed">0</strong></span>
    </div>
    <div class="status-right">
      <span id="sb-message"></span>
    </div>
  </footer>
</body>
</html>
