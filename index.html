<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>文件批量重命名 - 拖拽测试</title>
    <link rel="icon" href="data:," />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />
    <style>
      body {
        padding: 1rem;
      }
      #drop-zone {
        border: 2px dashed var(--pico-primary);
        padding: 2rem;
        text-align: center;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      #drop-zone:hover {
        background-color: rgba(var(--pico-primary-rgb), 0.1);
      }

      #drop-zone button:hover {
        background-color: rgba(var(--pico-primary-rgb), 0.15);
        border-color: var(--pico-primary);
      }
      .preview-highlight {
        color: var(--pico-primary);
        font-weight: bold;
      }
      .dimmed {
        color: var(--pico-secondary);
      }
      main {
  display: grid;
  grid-template-columns: minmax(340px, 2.2fr) minmax(280px, 1fr);
  gap: 1.2rem;
  align-items: start;
  height: 65vh;
  min-height: 380px;
  max-width: 1200px;
  margin: 0 auto;
}

aside {
  max-width: 420px;
  width: 100%;
}

@media (max-width: 1200px) {
  main {
    grid-template-columns: 1.6fr 1fr;
    gap: 0.8rem;
  }
  aside {
    max-width: 100%;
  }
}

@media (max-width: 800px) {
  main {
    display: flex;
    flex-direction: column;
    height: auto;
  }
  aside {
    order: 1;
    max-width: 100%;
    width: 100%;
  }
  section {
    order: 2;
    max-width: 100%;
    width: 100%;
  }
}
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      /* Toolbar & Status Bar */
      .toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        padding: 0.5rem 0.25rem 0.6rem 0.25rem;
      }
      .toolbar .left-group { display: flex; align-items: center; gap: 0.5rem; }
      .toolbar .right-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .status-bar {
        position: sticky;
        bottom: 0;
        z-index: 3;
        padding: 0.5rem 0.75rem;
        border-top: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--pico-background-color, #fff);
      }
      .status-bar .status-left span { margin-right: 1rem; }
      .status-bar .status-right { color: var(--pico-secondary); }
    </style>
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body>
    <header class="toolbar">
      <div class="left-group">
        <img src="src-tauri/icons/32x32.png" alt="logo" style="width:40px;height:40px;">
        <h3 style="margin: 0;">文件批量重命名</h3>
      </div>
      <div class="right-group">
        <button id="apply-rename-top" class="primary-action" title="开始重命名">开始重命名</button>
        <button id="clear-all-top" class="danger-action" title="清空列表">清空</button>
        <button id="open-settings" class="secondary-action" title="设置">设置</button>
        <button id="theme-toggle" style="background: none; border: none; cursor: pointer; opacity: 0.9;">
          <span id="theme-icon" aria-label="切换主题" style="display:inline-block;width:28px;height:28px;vertical-align:middle;">
            <svg id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:block;"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
          </span>
        </button>
      </div>
    </header>


    <main>
      <section style="display: flex; flex-direction: column; height:100%;">
        <div id="drop-zone" class="card-group" style="border:2px dashed var(--pico-primary);border-radius:13px;padding:1.5rem 1rem;margin-bottom:1.2rem;background:#fafdff;display:flex;flex-direction:column;align-items:center;gap:0.85rem;transition:background 0.18s;">
  <div style="display:flex;gap:0.7rem;">
    <button id="select-files-btn" class="outline">选择文件</button>
    <button id="select-folder-btn" class="outline">选择文件夹</button>
  </div>
  <span style="font-size:0.98em;color:var(--pico-primary);font-weight:500;">可拖拽文件/文件夹或点击按钮导入</span>

</div>
<hr style="margin:0.6rem 0 1.1rem 0;border:0;border-top:1.5px dashed #e0e8ef;">

        <div style="flex: 1; display: flex; flex-direction: column;">
          <div class="file-list-scroll" style="flex:1 1 auto;max-height:60vh;min-height:180px;overflow:auto;border-radius:8px;box-shadow:0 1px 6px #0001;">
  <table style="width:100%; font-size: 0.9em;">
    <thead>
      <tr>
        <th colspan="6" id="file-count" style="text-align:left; font-size:0.92em; font-weight:normal; color:var(--pico-secondary); background:transparent;">已加载 0 个文件</th>
      </tr>
      <tr>
        <th scope="col">#</th>
        <th scope="col">原文件名</th>
        <th scope="col">扩展名</th>
        <th scope="col">大小</th>
        <th scope="col">修改时间</th>
        <th scope="col">新文件名 (预览)</th>
      </tr>
    </thead>
    <tbody id="file-table-body">
  <tr id="empty-tip-row">
    <td colspan="6" style="text-align:center;color:var(--pico-secondary);padding:2.5em 0;font-size:1.05em;">暂无文件，请拖拽或选择文件/文件夹导入</td>
  </tr>
</tbody>
  </table>
</div>
        </div>
        
      </section>

      <aside style="display: flex; flex-direction: column; height:100%; justify-content: space-between;">
        <div>
          <hgroup>
            <h4>重命名规则</h4>
            <h5 style="margin-bottom:0.5rem;">一次只可选择并执行一种规则</h5>
          </hgroup>

          <nav style="margin-bottom: 1rem;">
  <div class="tab-group" style="display:flex;gap:0.5rem;">
    <button type="button" class="tab-link active" data-tab="tab-replace">查找替换</button>
    <button type="button" class="tab-link" data-tab="tab-sequence">添加序列</button>
    <button type="button" class="tab-link" data-tab="tab-case">大小写</button>
  </div>
</nav>

          <div id="tab-replace" class="tab-content active">
            <label for="find">查找内容</label>
            <input type="text" id="find" name="find" placeholder="例如: IMG_" />
            <label for="replace">替换为</label>
            <input
              type="text"
              id="replace"
              name="replace"
              placeholder="例如: 旅行照片-"
            />
          </div>

          <div id="tab-sequence" class="tab-content">
            <fieldset>
              <legend>序列号位置</legend>
              <label for="pos-prefix">
                <input
                  type="radio"
                  id="pos-prefix"
                  name="position"
                  value="prefix"
                  checked
                />
                前缀
              </label>
              <label for="pos-suffix">
                <input
                  type="radio"
                  id="pos-suffix"
                  name="position"
                  value="suffix"
                />
                后缀
              </label>
            </fieldset>
            <label for="start">起始数字</label>
            <input type="number" id="start" name="start" value="1" />
            <label for="digits">数字位数 (不足补0)</label>
            <input
              type="number"
              id="digits"
              name="digits"
              value="2"
              placeholder="例如: 2 会生成 01, 02..."
            />
          </div>

          <div id="tab-case" class="tab-content">
            <fieldset>
              <legend>转换规则</legend>
              <label for="case-upper">
                <input type="radio" id="case-upper" name="caseType" value="upper" />
                全部大写（UPPERCASE）
              </label>
              <label for="case-lower">
                <input type="radio" id="case-lower" name="caseType" value="lower" />
                全部小写（lowercase）
              </label>
              <label for="case-capitalize">
                <input type="radio" id="case-capitalize" name="caseType" value="capitalize" />
                首字母大写（Capitalize）
              </label>
            </fieldset>
          </div>
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
  <button id="apply-rename" class="primary-action" style="flex:1; white-space: nowrap;">执行重命名</button>
  <button id="clear-all" class="danger-action" style="flex:1; white-space: nowrap;">全部清空</button>
</div>

      </aside>

    </main>

    
    <script>
      console.log("🚀 开始设置应用");

        document.addEventListener("DOMContentLoaded", async function () {
          // --- 大小写按钮组高亮与切换 ---
          document.querySelectorAll('.case-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              document.querySelectorAll('.case-btn').forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
            });
          });
          // --- 序列号前缀/后缀单选按钮修复 ---
          document.querySelectorAll('input[name="position"]').forEach(function(radio){
            radio.addEventListener('change',function(){
              document.querySelectorAll('input[name="position"]').forEach(r=>{
                if(r!==radio) r.checked=false;
              });
              radio.checked=true;
            });
          });
          // --- Tab切换：为所有.tab-link按钮添加点击事件 ---
          document.querySelectorAll('.tab-link').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
              e.preventDefault();
              // 移除所有tab-link和tab-content的active
              document.querySelectorAll('.tab-link').forEach(b => b.classList.remove('active'));
              document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
              // 当前tab-link和对应内容加active
              btn.classList.add('active');
              var tabId = btn.getAttribute('data-tab');
              var tabContent = document.getElementById(tabId);
              if(tabContent) tabContent.classList.add('active');
              // 立即更新预览
              if (window.updatePreview) {
                window.updatePreview();
              }
              console.log("Tab switched to:", tabId);
            });
          });
          console.log("📋 DOM 已加载");
          // 检查 Tauri API
          if (typeof window.__TAURI__ === "undefined") {
            console.error("❌ Tauri API 不可用");
            return;
          }
          console.log("✅ Tauri API 可用");

        // 设置按钮事件
        setupButtons();

          // 尝试设置拖拽（可能不工作）
          await setupDragDrop();

          // 顶部工具栏按钮联动
          const topStartBtn = document.getElementById("apply-rename-top");
          const asideStartBtn = document.getElementById("apply-rename");
          if (topStartBtn && asideStartBtn) {
            topStartBtn.addEventListener("click", () => asideStartBtn.click());
          }
          const topClearBtn = document.getElementById("clear-all-top");
          if (topClearBtn) {
            topClearBtn.addEventListener("click", () => clearAll());
          }
          const settingsBtn = document.getElementById("open-settings");
          if (settingsBtn) {
            settingsBtn.addEventListener("click", () => alert("设置面板开发中"));
          }
        });

      function setupButtons() {
        const selectFilesBtn = document.getElementById("select-files-btn");
        const applyRenameBtn = document.getElementById("apply-rename");
        const clearAllBtn = document.getElementById("clear-all");

        selectFilesBtn.addEventListener("click", async () => {
          try {
            const { open } = window.__TAURI__.dialog;
            const selected = await open({
              multiple: true,
              directory: false,
            });

            if (selected) {
              const files = Array.isArray(selected) ? selected : [selected];
              console.log("选中的文件:", files);
              displayFiles(files);
            }
          } catch (error) {
            console.error("文件选择失败:", error);
            alert("文件选择失败: " + error.message);
          }
        });

        // 执行重命名按钮事件
        console.log("📋 [HTML] setupButtons 完成，apply-rename按钮:", applyRenameBtn);
        
        applyRenameBtn.addEventListener("click", async () => {
          console.log("🚀 [HTML] 点击了执行重命名按钮");
          
          // 直接从DOM检查是否有文件
          const fileRows = document.querySelectorAll("#file-table-body tr:not(#empty-tip-row)");
          console.log("🚀 [HTML] 找到的文件行数:", fileRows.length);
          
          if (fileRows.length === 0) {
            console.log("❌ [HTML] 没有找到文件，显示提示");
            alert("请先选择文件");
            return;
          }
          
          // 等待main.js加载完成
          let retryCount = 0;
          while (!window.getLoadedFiles && retryCount < 10) {
            console.log("⏳ [HTML] 等待main.js加载...", retryCount);
            await new Promise(resolve => setTimeout(resolve, 100));
            retryCount++;
          }
          
          if (!window.getLoadedFiles) {
            console.error("❌ [HTML] main.js未加载完成，使用备用方案");
            alert("系统未完全加载，请稍后重试");
            return;
          }
          
          const loadedFiles = window.getLoadedFiles();
          console.log("🚀 [HTML] loadedFiles:", loadedFiles);
          
          // 获取当前标签页
          const activeTab = document.querySelector(".tab-content.active");
          if (!activeTab) {
            alert("无法识别当前激活的标签页");
            return;
          }
          
          const activeTabId = activeTab.id.replace("tab-", "");
          console.log("🚀 [HTML] 当前标签页:", activeTabId);
          
          // 等待executeRename函数加载
          let executeRetryCount = 0;
          while (!window.executeRename && executeRetryCount < 20) {
            console.log("⏳ [HTML] 等待executeRename函数加载...", executeRetryCount);
            await new Promise(resolve => setTimeout(resolve, 50));
            executeRetryCount++;
          }
          
          // 调用main.js中的executeRename函数
          if (window.executeRename) {
            const filePaths = loadedFiles.map(f => f.path);
            let ruleData = {};
            
            switch (activeTabId) {
              case "replace":
                ruleData = {
                  find: document.getElementById("find").value,
                  replace: document.getElementById("replace").value,
                };
                break;
              case "sequence":
                const positionElement = document.querySelector('input[name="position"]:checked');
                ruleData = {
                  start: parseInt(document.getElementById("start").value) || 1,
                  digits: parseInt(document.getElementById("digits").value) || 2,
                  position: positionElement ? positionElement.value : "prefix",
                };
                break;
              case "case":
                const checked = document.querySelector('#tab-case input[name="caseType"]:checked');
                ruleData = { caseType: checked ? checked.value : "" };
                break;
            }
            
            console.log("🚀 [HTML] 调用executeRename:", { filePaths, activeTabId, ruleData });
            await window.executeRename(filePaths, activeTabId, ruleData);
          } else {
            console.error("❌ [HTML] executeRename函数加载超时");
            alert("系统未完全加载，请刷新页面重试");
          }
        });

        // 清空按钮
        clearAllBtn.addEventListener("click", () => {
          clearAll();
        });

        // 实时预览 - 为所有输入控件添加
        const findInput = document.getElementById("find");
        const replaceInput = document.getElementById("replace");
        const startInput = document.getElementById("start");
        const digitsInput = document.getElementById("digits");

        // 直接绑定预览事件，使用简单的方式
        function bindPreviewEvents() {
          console.log("📋 [HTML] 开始绑定预览事件");
          
          findInput.addEventListener("input", () => {
            console.log("📋 [HTML] find输入变化");
            if (window.updatePreview) window.updatePreview();
          });
          
          replaceInput.addEventListener("input", () => {
            console.log("📋 [HTML] replace输入变化");
            if (window.updatePreview) window.updatePreview();
          });
          
          startInput.addEventListener("input", () => {
            console.log("📋 [HTML] start输入变化");
            if (window.updatePreview) window.updatePreview();
          });
          
          digitsInput.addEventListener("input", () => {
            console.log("📋 [HTML] digits输入变化");
            if (window.updatePreview) window.updatePreview();
          });

          // 为序列位置单选框添加预览更新
          document.querySelectorAll('input[name="position"]').forEach(function(radio) {
            radio.addEventListener('change', () => {
              console.log("📋 [HTML] position变化");
              if (window.updatePreview) window.updatePreview();
            });
          });

          // 为大小写转换单选框添加预览更新
          document.querySelectorAll('#tab-case input[name="caseType"]').forEach(function(radio) {
            radio.addEventListener('change', () => {
              console.log("📋 [HTML] caseType变化");
              if (window.updatePreview) window.updatePreview();
            });
          });
          
          console.log("📋 [HTML] 预览事件监听器绑定完成");
        }
        
        // 立即绑定事件
        bindPreviewEvents();
      }

      async function setupDragDrop() {
        try {
          const { listen } = window.__TAURI__.event;

          // 尝试多种可能的事件名称
          const eventNames = [
            "tauri://file-drop",
            "tauri://drag-drop",
            "file-drop",
            "drag-drop",
          ];

          for (const eventName of eventNames) {
            try {
              await listen(eventName, (event) => {
                console.log(`🎉 检测到事件 ${eventName}:`, event);
                console.log(`🎉 事件载荷:`, event.payload);

                // 检查载荷的结构
                if (event.payload) {
                  if (Array.isArray(event.payload)) {
                    // 如果载荷直接是数组
                    displayFiles(event.payload);
                  } else if (
                    event.payload.paths &&
                    Array.isArray(event.payload.paths)
                  ) {
                    // 如果载荷有 paths 属性
                    displayFiles(event.payload.paths);
                  } else if (typeof event.payload === "object") {
                    // 如果载荷是对象，尝试找到文件路径
                    console.log("🔍 载荷对象结构:", Object.keys(event.payload));

                    // 尝试常见的属性名
                    const possibleKeys = [
                      "files",
                      "items",
                      "data",
                      "filePaths",
                    ];
                    let found = false;

                    for (const key of possibleKeys) {
                      if (
                        event.payload[key] &&
                        Array.isArray(event.payload[key])
                      ) {
                        displayFiles(event.payload[key]);
                        found = true;
                        break;
                      }
                    }

                    if (!found) {
                      console.log(
                        "检测到拖拽，但无法解析文件路径。载荷结构: " +
                          Object.keys(event.payload).join(", ")
                      );
                    }
                  } else {
                    console.log("🤔 未知的载荷格式:", typeof event.payload);
                  }
                } else {
                  console.log("检测到拖拽事件，但没有载荷数据");
                }
              });
              console.log(`✅ 监听事件: ${eventName}`);
            } catch (e) {
              console.log(`❌ 无法监听事件: ${eventName}`);
            }
          }

          // 也尝试悬停和取消事件
          try {
            await listen("tauri://file-drop-hover", (event) => {
              console.log("🎯 拖拽悬停");
              document.body.style.backgroundColor = "#f0f8ff";
            });

            await listen("tauri://file-drop-cancelled", (event) => {
              console.log("❌ 拖拽取消");
              document.body.style.backgroundColor = "";
            });
          } catch (e) {
            console.log("❌ 无法设置悬停/取消事件");
          }
        } catch (error) {
          console.error("❌ 拖拽设置失败:", error);
        }
      }

      // displayFiles函数已在下方重新定义

      // 全局变量存储当前文件列表
      let currentFiles = [];

      // 状态栏更新函数
      function updateStatusBar({ total = 0, selected = 0, success = 0, failed = 0, message = "" } = {}) {
        const el = document.getElementById("status-bar");
        if (!el) return;
        const setText = (id, val) => {
          const node = document.getElementById(id);
          if (node) node.textContent = String(val);
        };
        setText("sb-total", total);
        setText("sb-selected", selected);
        setText("sb-success", success);
        setText("sb-failed", failed);
        const msg = document.getElementById("sb-message");
        if (msg) msg.textContent = message;
      }

      // 处理文件夹
      async function handleFolders(folders) {
        console.log("处理文件夹:", folders);

        try {
          const { invoke } = window.__TAURI__.core;

          if (folders.length === 1) {
            // 单个文件夹：展开内部文件
            console.log("单个文件夹模式：展开内部文件");
            const files = await invoke("get_files_from_paths", {
              paths: folders,
            });
            console.log("展开的文件:", files);
            displayFiles(files);
          } else {
            // 多个文件夹：重命名文件夹本身
            console.log("多个文件夹模式：重命名文件夹本身");
            displayFiles(folders);
          }
        } catch (error) {
          console.error("处理文件夹失败:", error);
          alert("处理文件夹失败: " + error.message);
        }
      }

      // 智能处理选中的项目
      async function handleSelectedItems(items) {
        console.log("处理选中的项目:", items);

        try {
          const { invoke } = window.__TAURI__.core;

          // 检查选中项目的类型
          const itemTypes = await Promise.all(
            items.map(async (item) => {
              try {
                // 调用后端检查是文件还是文件夹
                const result = await invoke("get_files_from_paths", {
                  paths: [item],
                });
                return {
                  path: item,
                  isDirectory:
                    result.length > 1 ||
                    (result.length === 1 && result[0] !== item),
                  files: result,
                };
              } catch (error) {
                console.error("检查项目类型失败:", item, error);
                return {
                  path: item,
                  isDirectory: false,
                  files: [item],
                };
              }
            })
          );

          console.log("项目类型分析:", itemTypes);

          // 判断处理逻辑
          const directories = itemTypes.filter((item) => item.isDirectory);
          const files = itemTypes.filter((item) => !item.isDirectory);

          let finalFiles = [];

          if (directories.length === 1 && files.length === 0) {
            // 单个文件夹：重命名文件夹内的文件
            console.log("单个文件夹模式：重命名文件夹内的文件");
            finalFiles = directories[0].files;
          } else if (directories.length > 1 && files.length === 0) {
            // 多个文件夹：重命名文件夹本身
            console.log("多个文件夹模式：重命名文件夹本身");
            finalFiles = directories.map((dir) => dir.path);
          } else if (files.length > 0 && directories.length === 0) {
            // 只有文件：重命名文件
            console.log("文件模式：重命名文件");
            finalFiles = files.map((file) => file.path);
          } else {
            // 混合模式：文件夹展开为内部文件，文件保持原样
            console.log("混合模式：文件夹展开，文件保持");
            finalFiles = [];

            // 添加所有文件
            files.forEach((file) => {
              finalFiles.push(file.path);
            });

            // 添加文件夹内的文件
            directories.forEach((dir) => {
              finalFiles.push(...dir.files);
            });
          }

          console.log("最终文件列表:", finalFiles);
          displayFiles(finalFiles);
        } catch (error) {
          console.error("处理选中项目失败:", error);
          alert("处理选中项目失败: " + error.message);
        }
      }

      // 更新 displayFiles 函数以保存文件列表
      function displayFiles(files) {
        currentFiles = files; // 保存到全局变量
        
        // 同步到main.js中的loadedFiles变量
        if (window.setLoadedFiles) {
          window.setLoadedFiles(files);
        }

        const tbody = document.getElementById("file-table-body");
        tbody.innerHTML = "";

        files.forEach((file, index) => {
          const fileName = file.split("/").pop() || file.split("\\\\").pop();
          // 初始状态不显示预览，等待用户输入规则后再更新
          const previewName = fileName;
          const hasChange = false;

          const row = document.createElement("tr");
          row.innerHTML = `
            <th scope="row">${index + 1}</th>
            <td>${fileName}</td>
            <td class="preview-cell ${
              hasChange ? "preview-highlight" : "dimmed"
            }">
                ${hasChange ? previewName : "(无变化)"}
            </td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById(
          "file-count"
        ).textContent = `已加载 ${files.length} 个文件`;
        console.log("📁 显示文件:", files);
        // 更新状态栏
        updateStatusBar({ total: files.length, selected: 0 });
        
        // 初始化预览
        setTimeout(() => {
          if (window.updatePreview) {
            console.log("📁 [displayFiles] 调用updatePreview初始化预览");
            window.updatePreview();
          }
        }, 100);
      }

      // 获取预览名称 - 支持所有标签页类型
      function getPreviewName(fileName, fileIndex = 0) {
        const activeTab = document.querySelector(".tab-content.active");
        if (!activeTab) return fileName;

        const tabId = activeTab.id;

        switch (tabId) {
          case "tab-replace": {
            const findText = document.getElementById("find").value;
            const replaceText = document.getElementById("replace").value;
            if (!findText) return fileName;
            return fileName.replace(new RegExp(findText, "g"), replaceText);
          }
          case "tab-sequence": {
            const start = parseInt(document.getElementById("start").value) || 1;
            const digits = parseInt(document.getElementById("digits").value) || 2;
            const position = document.querySelector('input[name="position"]:checked')?.value || "prefix";
            
            const currentSequenceNumber = start + fileIndex;
            const sequenceNumber = currentSequenceNumber.toString().padStart(digits, "0");
            
            const fileExtension = fileName.includes(".") ? "." + fileName.split(".").pop() : "";
            const fileNameWithoutExt = fileName.includes(".") ? fileName.substring(0, fileName.lastIndexOf(".")) : fileName;
            
            return position === "prefix" 
              ? `${sequenceNumber}_${fileName}`
              : `${fileNameWithoutExt}_${sequenceNumber}${fileExtension}`;
          }
          case "tab-case": {
            const checked = document.querySelector('#tab-case input[name="caseType"]:checked');
            if (!checked) return fileName;
            const val = checked.value;
            
            if (val === "lower") return fileName.toLowerCase();
            else if (val === "upper") return fileName.toUpperCase();
            else if (val === "capitalize") {
              return fileName.replace(/(^|[^a-zA-Z])([a-z])/g, (m, pre, char) => pre + char.toUpperCase());
            }
            return fileName;
          }
          default:
            return fileName;
        }
      }

      // 执行重命名功能由 main.js 中的完整实现处理

      // 清空所有
      function clearAll() {
        currentFiles = [];
        const tbody = document.getElementById("file-table-body");
        tbody.innerHTML = "";
        document.getElementById("file-count").textContent = "已加载 0 个文件";

        // 清空输入框
        document.getElementById("find").value = "";
        document.getElementById("replace").value = "";

        // 更新状态栏
        updateStatusBar({ total: 0, selected: 0, success: 0, failed: 0, message: "" });
      }

      // updatePreview函数现在由main.js提供
    </script>
  <script type="module" src="src/main.js"></script>

  <!-- 底部状态栏 -->
  <footer id="status-bar" class="status-bar">
    <div class="status-left">
      <span>总数: <strong id="sb-total">0</strong></span>
      <span>选中: <strong id="sb-selected">0</strong></span>
      <span>成功: <strong id="sb-success">0</strong></span>
      <span>失败: <strong id="sb-failed">0</strong></span>
    </div>
    <div class="status-right">
      <span id="sb-message"></span>
    </div>
  </footer>
</body>
</html>
