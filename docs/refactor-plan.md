# 代码重构与模块化计划

## 目标
- 提高代码可维护性
- 降低模块间耦合度
- 便于功能扩展
- 提高测试覆盖率

## 目录结构
```
src/
├── core/                  # 核心模块
│   ├── event-bus.js       # 事件总线
│   ├── state-manager.js   # 状态管理
│   └── utils/             # 工具函数
│       ├── file-utils.js
│       ├── validation-utils.js
│       └── dom-utils.js
│
├── features/             # 功能模块
│   ├── rename/           # 重命名功能
│   │   ├── controller.js
│   │   └── undo-manager.js
│   ├── preview/          # 预览功能
│   └── file-list/        # 文件列表管理
│
├── components/           # UI组件
│   ├── toolbar/          # 工具栏
│   ├── file-list/        # 文件列表
│   └── rule-panel/       # 规则面板
│
└── services/             # 服务层
    ├── tauri-service.js  # 后端通信
    ├── storage-service.js
    └── history-service.js
```

## 实施路线图

### 阶段一：基础设施准备
1. [ ] 创建目录结构
2. [ ] 实现事件总线
3. [ ] 实现基础状态管理
4. [ ] 迁移工具函数

### 阶段二：功能模块拆分
1. [ ] 抽离撤销重做功能
2. [ ] 重构文件列表管理
3. [ ] 实现预览功能模块
4. [ ] 抽离规则处理逻辑

### 阶段三：UI组件化
1. [ ] 工具栏组件化
2. [ ] 文件列表组件化
3. [ ] 规则面板组件化
4. [ ] 状态栏组件化

### 阶段四：测试与优化
1. [ ] 编写单元测试
2. [ ] 性能优化
3. [ ] 文档更新
4. [ ] 代码审查

## 详细任务说明

### 1. 事件总线实现
- 实现发布/订阅模式
- 支持异步事件处理
- 提供类型安全的事件定义

### 2. 状态管理
- 实现响应式状态
- 支持状态持久化
- 提供状态变更订阅

### 3. 撤销重做功能
- 抽离撤销逻辑到独立模块
- 实现操作栈管理
- 支持批量操作撤销

### 4. 文件列表管理
- 实现虚拟滚动
- 支持多选/排序/过滤
- 优化大列表性能

## 依赖关系
```
core/event-bus.js ← features/*
core/state-manager.js ← components/*
features/ ← components/
services/ ← features/ & components/
```

## 测试策略
- 单元测试：测试独立功能模块
- 集成测试：测试模块间交互
- E2E测试：测试完整用户流程

## 性能指标
- 初始加载时间 < 1s
- 文件列表滚动 60fps
- 内存占用 < 100MB (1000个文件)

## 文档要求
- 每个模块添加 JSDoc 注释
- 编写使用示例
- 维护更新日志
